(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{1351:function(t,e,o){var content=o(1696);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(17).default)("e9ed0c06",content,!0,{sourceMap:!1})},1695:function(t,e,o){"use strict";var l=o(1351);o.n(l).a},1696:function(t,e,o){(t.exports=o(16)(!1)).push([t.i,".tips-p[data-v-357bc0a4]{color:#999}.el-link--inner a[data-v-357bc0a4]{color:#1a77ff!important;margin-left:10px;display:inline-block}.right-main-warpper[data-v-357bc0a4]{background:#fff}.right-main-warpper .search-bar-wrapper[data-v-357bc0a4]{padding-top:8px}.right-main-warpper .search-bar-wrapper .el-select[data-v-357bc0a4]{width:100%}.right-main-warpper .el-button+.el-button[data-v-357bc0a4]{margin-left:5px}.right-main-warpper[data-v-357bc0a4] .demo-table-expand{font-size:0}.right-main-warpper[data-v-357bc0a4] .demo-table-expand.dialog-expand .el-form-item{margin-bottom:8px}.right-main-warpper[data-v-357bc0a4] .demo-table-expand.dialog-expand .el-form-item label{color:#0d87d4;text-align:left}.right-main-warpper[data-v-357bc0a4] .demo-table-expand.dialog-expand .el-form-item .el-form-item__content{width:calc(100% - 20px)}.right-main-warpper[data-v-357bc0a4] .demo-table-expand .el-form-item{margin-right:0;margin-bottom:0;width:100%}.right-main-warpper[data-v-357bc0a4] .demo-table-expand .el-form-item label{width:110px;text-align:right;padding-left:5px;display:inline-block}.right-main-warpper[data-v-357bc0a4] .demo-table-expand .el-form-item .el-form-item__content{height:43px;width:calc(100% - 120px);text-align:left}.right-main-warpper[data-v-357bc0a4] .demo-table-expand .el-form-item .el-form-item__content .span-show{height:32px;display:inline-block;width:auto;max-width:100%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.right-main-warpper .row-bg[data-v-357bc0a4]{padding:15px 0 10px}.right-main-warpper .showHide[data-v-357bc0a4]{display:none}.notab[data-v-357bc0a4]{border-top:none}.task-list-content[data-v-357bc0a4]{background:#fff;padding:5px}.task-list-content .task-list-top[data-v-357bc0a4]{text-align:right;margin:5px 0;vertical-align:top}.task-list-content .task-list-top .el-button--primary[data-v-357bc0a4]{vertical-align:top}.task-list-content .height-200[data-v-357bc0a4]{padding:30px 0}.height-300[data-v-357bc0a4]{padding:5px 0;max-height:600px;overflow-x:hidden;overflow-y:auto}.fenpai-form[data-v-357bc0a4]{text-align:left}.fenpai-form .el-form--label-top .el-form-item__label[data-v-357bc0a4]{text-align:left!important}.fenpai-form .el-select[data-v-357bc0a4]{width:100%}[data-v-357bc0a4] .el-table .el-table__body-wrapper{height:calc(100vh - 208px);overflow-y:auto}.input-textarea-diy[data-v-357bc0a4]{font-size:14px;line-height:24px}",""])},1840:function(t,e,o){"use strict";o.r(e);o(77),o(316);var l=o(6),n=o(1148),r=(o(51),o(1147)),c=o(1196),d=o(1197),m=o(1198),f={components:{Title:n.a,Pagination:r.a,Upload:c.a,EditUpload:d.a,OtherUpload:m.a},data:function(){return{rejectVal:null,assignmentList:[],restaurants:[],assignment:"",dialogFenpaiVisible:!1,facilitiesInData:{},selectedOptions:["1"],dialogEditVisible:!1,dialogVisible:!1,formLabelWidth:"120px",callbackFlag:!1,widgetInfo:{total:null,pageSize:12,pageNo:1},tableData:[],isLoading:!1,uploadDataVal:{},editUploadData:{},otherUpload:{},roleName:null,roleId:null,userId:null,loading:!1,recordStatusList:[{id:"001",value:"",label:"全部"},{id:"002",value:"1",label:"初审中"},{id:"003",value:"2",label:"初审驳回"},{id:"004",value:"3",label:"复审中"},{id:"005",value:"4",label:"复审驳回"},{id:"006",value:"5",label:"建档中"},{id:"007",value:"6",label:"建档驳回"},{id:"008",value:"7",label:"建档审核"},{id:"009",value:"8",label:"同步数据"},{id:"010",value:"9",label:"数据回滚"}],roleNames:"超级管理员,建档人员"}},created:function(){},mounted:function(){var t=this;t.facilitiesInData=t._Storage.getObj("fileItem","obj"),this.$nextTick(function(){t.roleName=localStorage.getItem("roleName"),t.roleId=localStorage.getItem("roleId"),t.userId=localStorage.getItem("userId"),t.loadData(),"9"==t.facilitiesInData.recordStatus&&(t.callbackFlag=!0)})},methods:{fenpaiFun:function(){this.dialogFenpaiVisible=!0,this.assignHandel()},handleCloseEdit:function(){this.dialogEditVisible=!1,this.$refs.myChild.dataDigEmp()},jumpEditAll:function(){this.$router.push({name:"PatrolPlan-editAll"})},handleClose:function(){this.dialogVisible=!1,this.rejectVal=null},showButton:function(t,e){return t.indexOf(1*e)>-1},saveHandelEdit:function(data){this._Storage.setObj("fileItem","obj",data),this.facilitiesInData=this._Storage.getObj("fileItem","obj"),this.dialogEditVisible=!1},loadData:function(){var t=this;t.isLoading=!0;var e=t.facilitiesInData;l.a.post("/remoteApi/tool/recordTrial/findRecordTrialRecordList",{trialId:t.facilitiesInData.id},5e3).then(function(o){t.isLoading=!1,"success"===o.code&&(t.tableData=o.data,null!=t.tableData&&t.tableData.length>0&&(t.tableData.forEach(function(e){e.recordStatusName=t.recordStatusList.find(function(t){return t.value==e.recordStatus}).label}),e.recordStatus=t.tableData[t.tableData.length-1].recordStatus,t._Storage.setObj("fileItem","obj",e)))}).catch(function(e){t.isLoading=!1,t.$message({type:"warning",message:e})})},sonHandleCurrentChange:function(t){this.widgetInfo.pageSize=t.pageSize?parseInt(t.pageSize):this.widgetInfo.pageSize,this.widgetInfo.pageNo=t.pageNo?parseInt(t.pageNo):this.widgetInfo.pageNo,this.loadData()},handleDown:function(){var t=this;this.$confirm("确定要下载吗?","下载提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){window.open("/remoteApi/tool/record/downAttachment?fileId="+t.facilitiesInData.id)}).catch(function(e){t.$message({type:"warning",message:"取消下载!"})})},handleEdit:function(){var t=this.facilitiesInData;this.dialogEditVisible=!0,this.editUploadData={editVal:{fileUrl:""!=t.fileUrls&&null!=t.fileName?t.fileUrls.split(","):null,fileName:""!=t.fileName&&null!=t.fileName?t.fileName.split(","):null,oprFlag:t.oprFlag,priority:t.priority,describes:t.describes,operationId:t.subCenterCode,unitId:t.unitId,rowId:t.id,recordStatus:t.recordStatus,timestamp:t.timestamp||t.fileTimestamp,trialId:t.id}}},dataCallBack:function(){var t=this,e=t.facilitiesInData;t.$confirm("确定要回滚吗?","回滚提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.loading=!0,l.a.post("/remoteApi/tool/synchro/commandRollBack",{orgCode:e.subCenterCode,trialId:e.id,unitId:e.unitId,userId:l.a.getGlobalVal("userObj").id,userName:l.a.getGlobalVal("userObj").userName},36e5).then(function(o){"success"===o.code?(t.loading=!1,t.$message({type:"success",message:"回滚成功"}),e.recordStatus=o.data.recordStatus,t._Storage.setObj("fileItem","obj",e),e=t._Storage.getObj("fileItem","obj"),t.callbackFlag=!0):(t.loading=!1,t.$message({type:"error",message:o.rspMsg}))}).catch(function(e){t.loading=!1,t.$message({type:"warning",message:e})})}).catch(function(e){t.$message({type:"warning",message:e})})},setRcordStatus:function(t,e){var o=this,n=this,r=n.facilitiesInData,c=["通过","提交审核","同步","驳回","分派"];n.$confirm("确定要"+c[t]+"吗?",c[t]+"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){2==t?(n.loading=!0,l.a.post("/remoteApi/tool/synchro/commandSyn",{orgCode:r.subCenterCode,trialId:r.id,unitId:r.unitId,userId:l.a.getGlobalVal("userObj").id,userName:l.a.getGlobalVal("userObj").userName},36e5).then(function(t){"success"==t.code?(n.loading=!1,o.$message({type:"success",message:t.rspMsg}),r.recordStatus=t.data.recordStatus,n._Storage.setObj("fileItem","obj",r),r=n._Storage.getObj("fileItem","obj")):(n.loading=!1,o.$message({type:"error",message:t.rspMsg}))}).catch(function(t){n.loading=!1,o.$message({type:"error",message:t})})):4==t?l.a.post("/remoteApi/tool/recordTrial/appointOperator",{trialId:n.facilitiesInData.id,userId:n.assignment,trialManCode:3},5e3).then(function(l){"success"===l.code?(n.updateRecordTrialRecordStatus(n,r,t,e),n.dialogFenpaiVisible=!1):o.$message({type:"error",message:l.rspMsg})}).catch(function(t){n.$message({type:"warning",message:t})}):n.updateRecordTrialRecordStatus(n,r,t,e)})},updateRecordTrialRecordStatus:function(t,e,o,n){var r=this;l.a.post("/remoteApi/tool/recordTrial/updateRecordTrialRecordStatus",{trialId:e.id,recordStatus:e.recordStatus,userId:l.a.getGlobalVal("userObj").id,userName:l.a.getGlobalVal("userObj").userName,operationStatus:n,oprFlag:e.oprFlag,opinions:t.rejectVal},5e3).then(function(l){"success"===l.code?(r.$message({type:"success",message:"操作成功"}),e.recordStatus=l.data.rtnStatus,t._Storage.setObj("fileItem","obj",e),e=t._Storage.getObj("fileItem","obj"),t.loadData(),4==o&&(t.dialogFenpaiVisible=!1),3==o&&(t.dialogVisible=!1,t.rejectVal="")):t.$message({type:"error",message:l.rspMsg})}).catch(function(t){r.$message({type:"warning",message:t})})},assignHandel:function(){var t=this;l.a.post("/remoteApi/tool/user/getUserListByRoleNames",{roleNames:t.roleNames},5e3).then(function(e){"success"===e.code?e.data.map(function(e){t.assignmentList.push({label:e.userName,value:e.userId})}):t.$message({type:"error",message:"获取失败"})}).catch(function(e){t.$message({type:"warning",message:e})})},assignSureHandel:function(){""!=this.assignment?this.setRcordStatus(4,1):this.$message({type:"warning",message:"指定建档人不能为空"})}}},h=(o(1695),o(31)),component=Object(h.a)(f,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticClass:"right-main-warpper"},[o("div",{staticClass:"h2-title-wrap"},[o("h2",{staticClass:"tilte-h2"},[t._v("任务记录")]),t._v(" "),o("div",{staticClass:"title-btn-wrap"},["超级管理员"==t.roleName?[t.showButton([1],t.facilitiesInData.recordStatus)?o("el-button",{attrs:{type:"success",icon:"el-icon-check"},on:{click:function(e){return t.setRcordStatus(0,1)}}},[t._v("通过")]):t._e(),t._v(" "),t.showButton([1,3,7],t.facilitiesInData.recordStatus)?o("el-button",{attrs:{type:"danger",icon:"el-icon-close"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("驳回")]):t._e(),t._v(" "),t.showButton([2,4],t.facilitiesInData.recordStatus)?o("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(e){return t.handleEdit()}}},[t._v("修改任务")]):t._e(),t._v(" "),t.showButton([2,4,5,6],t.facilitiesInData.recordStatus)?o("el-button",{attrs:{type:"success",icon:"el-icon-document-add"},on:{click:function(e){return t.setRcordStatus(1,1)}}},[t._v("提交审核")]):t._e(),t._v(" "),t.showButton([3],t.facilitiesInData.recordStatus)?o("el-button",{attrs:{type:"primary",icon:"el-icon-user"},on:{click:t.fenpaiFun}},[t._v("分派")]):t._e(),t._v(" "),t.showButton([5,6,7],t.facilitiesInData.recordStatus)?o("el-button",{attrs:{type:"primary",icon:"el-icon-edit-outline"},on:{click:t.jumpEditAll}},[t._v("编辑档案/标点")]):t._e()]:t._e(),t._v(" "),"审核人员"==t.roleName?[t.showButton([1],t.facilitiesInData.recordStatus)?o("el-button",{attrs:{type:"success",icon:"el-icon-check"},on:{click:function(e){return t.setRcordStatus(0,1)}}},[t._v("通过")]):t._e(),t._v(" "),t.showButton([1],t.facilitiesInData.recordStatus)?o("el-button",{attrs:{type:"danger",icon:"el-icon-close"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("驳回")]):t._e()]:t._e(),t._v(" "),"分派人员"==t.roleName?[t.showButton([3],t.facilitiesInData.recordStatus)?o("el-button",{attrs:{type:"primary",icon:"el-icon-user"},on:{click:function(e){t.dialogFenpaiVisible=!0}}},[t._v("分派")]):t._e(),t._v(" "),t.showButton([3],t.facilitiesInData.recordStatus)?o("el-button",{attrs:{type:"danger",icon:"el-icon-close"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("驳回")]):t._e()]:t._e(),t._v(" "),"提交人员"==t.roleName?[t.showButton([2,4],t.facilitiesInData.recordStatus)?o("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(e){return t.handleEdit()}}},[t._v("修改任务")]):t._e(),t._v(" "),t.showButton([2,4],t.facilitiesInData.recordStatus)?o("el-button",{attrs:{type:"success",icon:"el-icon-document-add"},on:{click:function(e){return t.setRcordStatus(1,1)}}},[t._v("提交审核")]):t._e()]:t._e(),t._v(" "),"建档人员"==t.roleName?[t.showButton([5,6],t.facilitiesInData.recordStatus)?o("el-button",{attrs:{type:"success",icon:"el-icon-document-add"},on:{click:function(e){return t.setRcordStatus(1,1)}}},[t._v("提交审核")]):t._e(),t._v(" "),t.showButton([5,6],t.facilitiesInData.recordStatus)?o("el-button",{attrs:{type:"primary",icon:"el-icon-edit-outline"},on:{click:t.jumpEditAll}},[t._v("编辑档案/标点")]):t._e()]:t._e(),t._v(" "),o("el-button",{attrs:{type:"primary",icon:"el-icon-files"},on:{click:function(e){return t.handleDown()}}},[t._v("附件")]),t._v(" "),o("nuxt-link",{attrs:{to:{name:"PatrolPlan-FacilitiesInspection"}}},[t._v("<<返回")])],2)]),t._v(" "),o("div",{staticClass:"newTable"},[o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],ref:"table",attrs:{data:t.tableData,stripe:""}},[o("el-table-column",{attrs:{align:"left","min-width":"15%","show-overflow-tooltip":!0,prop:"username",label:"操作人"}}),t._v(" "),o("el-table-column",{attrs:{align:"left","min-width":"15%","show-overflow-tooltip":!0,pageSize:"pageSize",prop:"recordStatusName",label:"操作后状态"}}),t._v(" "),o("el-table-column",{attrs:{align:"left","min-width":"50%","show-overflow-tooltip":!0,pageSize:"pageSize",prop:"opinions",label:"驳回信息"}}),t._v(" "),o("el-table-column",{attrs:{align:"left","min-width":"20%","show-overflow-tooltip":!0,prop:"createdTime",label:"操作时间"}})],1)],1)]),t._v(" "),o("el-dialog",{attrs:{title:"分派",visible:t.dialogFenpaiVisible,width:"300px"},on:{"update:visible":function(e){t.dialogFenpaiVisible=e}}},[o("div",[o("p",{staticClass:"tips-p"},[t._v("(分派后默认通过复核，且建档人不可修改)")]),t._v(" "),o("div",{staticClass:"fenpai-form"},[o("el-form",{attrs:{"label-position":"top","label-width":"100px"}},[o("el-form-item",{attrs:{label:"指定建档人",rules:{required:!0,message:"指定建档人不能为空",trigger:"blur"}}},[o("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:t.assignment,callback:function(e){t.assignment=e},expression:"assignment"}},t._l(t.assignmentList,function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)],1)],1)]),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.assignSureHandel()}}},[t._v("确 定")]),t._v(" "),o("el-button",{on:{click:function(e){t.dialogFenpaiVisible=!1}}},[t._v("取 消")])],1)]),t._v(" "),o("el-dialog",{attrs:{"close-on-press-escape":!1,"close-on-click-modal":!1,"before-close":t.handleCloseEdit,title:"编辑",visible:t.dialogEditVisible,width:"580px"},on:{"update:visible":function(e){t.dialogEditVisible=e}}},[o("div",{staticClass:"height-300"},[o("EditUpload",{ref:"myChild",attrs:{editUploadData:t.editUploadData},on:{saveHandel:t.saveHandelEdit}})],1)]),t._v(" "),o("el-dialog",{attrs:{title:"驳回",visible:t.dialogVisible,width:"440px","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[o("el-form",{ref:"form"},[o("el-form-item",[o("el-input",{staticClass:"input-textarea-diy",attrs:{type:"textarea",rows:"6",placeholder:"请输入驳回信息",maxlength:"120","show-word-limit":""},model:{value:t.rejectVal,callback:function(e){t.rejectVal=e},expression:"rejectVal"}})],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.handleClose}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.setRcordStatus(3,2)}}},[t._v("确 定")])],1)],1)],1)},[],!1,null,"357bc0a4",null);e.default=component.exports}}]);