(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{1387:function(e,t,n){var content=n(1769);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(17).default)("43d6bb1c",content,!0,{sourceMap:!1})},1388:function(e,t,n){var content=n(1771);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(17).default)("6a8ea5da",content,!0,{sourceMap:!1})},1768:function(e,t,n){"use strict";var o=n(1387);n.n(o).a},1769:function(e,t,n){(e.exports=n(16)(!1)).push([e.i,"[v-cloak]{display:none}.el-tree--highlight-current .el-tree-node.is-current>.el-tree-node__content{background:rgba(32,160,255,.5)!important}.el-menu-item-group__title{padding:0}",""])},1770:function(e,t,n){"use strict";var o=n(1388);n.n(o).a},1771:function(e,t,n){(e.exports=n(16)(!1)).push([e.i,".el-main[data-v-03213967]{position:relative}.el-pagination[data-v-03213967]{height:26px;position:fixed;bottom:22px}.tit[data-v-03213967]{border-bottom:1px solid #bfcbd9;margin:0;line-height:30px;padding:0 10px}.el-button-group[data-v-03213967],.r[data-v-03213967]{line-height:40px}.r[data-v-03213967]{overflow:hidden}.r span[data-v-03213967]{float:left}.r .el-radio-group[data-v-03213967]{float:right;line-height:40px}.r .addBtn[data-v-03213967]{margin:6px 0 0 10px;float:right}.zTree .el-tree-node__content[data-v-03213967]{background-color:red!important}.el-button--mini[data-v-03213967],.el-button--small[data-v-03213967]{padding:5px;margin:2px}.el-aside[data-v-03213967]{background-color:#fff;color:#333;border:1px solid #bfcbd9;margin:10px;height:calc(100vh - 141px)}.orgBox[data-v-03213967]{position:absolute;font-size:12px;color:grey;border:1px solid #ccc;text-align:center;padding:0;width:90px;background:#fff;z-index:2}.orgBox li[data-v-03213967]{line-height:23px;padding:5px 0;width:100%;cursor:pointer}.orgBox li a[data-v-03213967]{width:100%;display:inline-block;color:grey}.orgBox li[data-v-03213967] :hover{background:#eee}.closeBox[data-v-03213967]{width:100%;height:100%}.el-main[data-v-03213967]{background-color:#fff;color:#333;border:1px solid #bfcbd9;margin:10px;padding:0;height:calc(100vh - 141px)}",""])},1875:function(e,t,n){"use strict";n.r(t);n(133),n(33),n(50);var o=n(6),r={data:function(){var e=this,t="",n=-1,r=null;return{cloShow:!1,userStatus:"0",setFlag:!0,flag:!0,isLoad:!0,firstLevel:!1,menuVisible:!1,markFloat:1,iconClass:"el-icon-delete",iconCont:"已激活",orgObj:"",tenantId:"",orgCode:"",keys:[],node:"",pageNo:1,pageSize:2,total:0,islock:!0,isFirst:!0,props:{label:"orgName",children:"zones",isLeaf:"leaf"},defaultProps:{children:"children",label:"label"},tableData:[],tempTreeData:"",zTreeObj:{},openId:"",setting:{async:{enable:!0,url:o.a.ajaxUrl+"/upmsOrg/findUpmsOrgTree",autoParam:["tenantId","parentCode","userId"],otherParam:{tenantId:function(){return t},parentCode:function(){return n}},dataFilter:function(e,t,n){if(n){if(!n.data)return null;for(var i=0,o=n.data.length;i<o;i++)n.data[i].name=n.data[i].orgName,n.data[i].id=n.data[i].orgId,n.data[i].isParent=!n.data[i].leaf;return n.data}}},callback:{onClick:function(o,r,l){t=e.tenantId=l.tenantId,n=e.orgCode=l.orgCode,e.orgObj=l,e.tempTreeData=l.orgId,console.log("点击treenodes")},beforeExpand:function(o,l){t=e.tenantId=l.tenantId,n=e.orgCode=l.orgCode,e.isFirst=!1;for(var d=r?r.getParentNode():null,c=l.parentTId?l.getParentNode():null,m=$.fn.zTree.getZTreeObj("treeDemo"),i=0,h=c?c.children.length:0;i<h;i++)l!==c.children[i]&&m.expandNode(c.children[i],!1);for(;d&&d!==l;)d=d.getParentNode();d||function(e){if(e!==r){var t,n,o,i,l,d,c=$.fn.zTree.getZTreeObj("treeDemo");if(r){if(r&&r.open)if(e.parentTId===r.parentTId)c.expandNode(r,!1);else{for(var m=[];e;){if((e=e.getParentNode())===r){m=null;break}e&&m.push(e)}if(null!=m){for(var h=r,f=[];h;)(h=h.getParentNode())&&f.push(h);m.length>0?c.expandNode(f[Math.abs(f.length-m.length)-1],!1):c.expandNode(f[f.length-1],!1)}}}else{for(n=e;n;)o=n.tId,n=n.getParentNode();for(i=0,l=(t=c.getNodes()).length;i<l;i++)(d=t[i]).tId!=o&&c.expandNode(d,!1)}r=e}}(l)},onAsyncError:function(t,n,o,r,l,d){e.$message({type:"error",message:"请求失败"})},onAsyncSuccess:function(o,r,l,d){if("success"==(d=JSON.parse(d)).code){if(e.isFirst){e.ztreeObj=$.fn.zTree.getZTreeObj("treeDemo");var c=e.ztreeObj.getNodeByParam("id",1);e.ztreeObj.selectNode(c,!0,!0),e.orgObj=d.data[0],e.tenantId=d.data[0].tenantId,e.orgCode=d.data[0].orgCode,e.tempTreeData=d.data[0].orgId}if(e.$route.params&&e.$route.params.id){e.openId=e.$route.params.id,t=e.tenantId=e.$route.params.tenantId,n=e.orgCode=e.$route.params.id,console.log(e.openId);var m=e.ztreeObj.getNodeByParam("id",e.openId,null);e.ztreeObj.cancelSelectedNode(),e.ztreeObj.selectNode(m,!0),e.isFirst&&e.ztreeObj.expandNode(m,!0,!0)}}},onRightClick:function(t,n,o){if(o){e.menuVisible=!0,e.firstLevel=0!==o.level;var menu=document.querySelector("#menu");menu.style.left=t.clientX+20+"px",menu.style.top=t.clientY-60+"px",e.orgCode=o.orgCode,e.keys=o.parentCode,e.orgObj=o,e.node=o}},onExpand:function(e,t,n){r=n}}},treeNode:[],zNodes:[{name:"test1",open:!0,children:[{name:"test1_1"},{name:"test1_2"}]},{name:"test2",open:!0,children:[{name:"test2_1"},{name:"test2_2"}]}]}},methods:{addUpdate:function(e,t,n){if("{}"==JSON.stringify(this.orgObj))this.$message({type:"warning",message:"请先选择组织机构!"});else{var o={};o=n?{orgObj:t,rowObj:n||null}:{orgObj:t},this.$router.push({name:e,params:o})}},handleDelete:function(e,t){var n=this;this.$confirm("确认注销该用户吗?","提示信息",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e={tenantId:n.tenantId,userIds:t.userId};o.a.post(o.a.ajaxUrl+"/upmsUser/deleteUser",e).then(function(e){"success"==e.data.code?(n.getUserList(0),n.$message({type:"success",message:"注销成功!"})):n.$message({type:"success",message:"注销失败!"})})}).catch(function(){n.$message({type:"info",message:"已取消删除"})})},orgDel:function(e,t){var n=this;this.$confirm("确认删除?","提示信息",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e={tenantId:t.tenantId,orgId:t.orgId};o.a.post(o.a.ajaxUrl+"upmsOrg/deleteOrg",e).then(function(e){if("success"==e.data.code){n.ztreeObj=$.fn.zTree.getZTreeObj("treeDemo");var o=n.ztreeObj.getNodeByParam("id",t.orgId,null);n.ztreeObj.removeNode(o),n.$message({type:"success",message:"删除成功!"})}else n.$message({type:"success",message:"删除失败!"})})}).catch(function(e){n.$message({type:"info",message:"已取消删除"})})},closeBox:function(){this.menuVisible=!1},changeIcon:function(e,t){console.log(this.$refs.table),this.islock=!this.islock,this.islock?(this.iconClass="el-icon-delete",this.iconCont="已激活",t.status=0):(this.iconClass="el-icon-edit",this.iconCont="已锁定",t.status=1),this.$message({type:"success",message:"操作成功!"})},changeUser:function(label){this.setFlag=!this.setFlag,this.userStatus=label,this.pageNo=1,this.getUserList(label)},statusEve:function(e,t,n,o){return 0==e.status?"已激活":"待激活"},changePage:function(e){this.pageNo=e,this.getUserList(this.userStatus)},getUserList:function(e){var t=this;this.isLoad=!0;var n={pageNum:this.pageNo,pageSize:this.pageSize,tenantId:this.tenantId,orgCode:this.orgCode,userStatus:e};return o.a.post(o.a.ajaxUrl+"/upmsUser/queryUserList",n).then(function(e){e.data&&""!=e.data&&"success"==e.data.code&&(t.isLoad=!1,t.total=e.data.data.totalElements,t.tableData=e.data.data.content)})},testT:function(){this.$nextTick(function(){1==this.markFloat&&this.getUserList(this.userStatus)})}},watch:{tempTreeData:function(e,t){e!=t&&this.testT()}},mounted:function(){console.log($.fn.zTree),$.fn.zTree.init($("#treeDemo"),this.setting,this.treeNode)}},l=(n(1768),n(1770),n(31)),component=Object(l.a)(r,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-container",[n("el-aside",{attrs:{width:"200px"}},[n("div",{staticClass:"closeBox",on:{click:function(t){return e.closeBox()}}},[n("p",{staticClass:"tit"},[e._v("组织机构")]),e._v(" "),n("ul",{staticClass:"ztree",attrs:{id:"treeDemo"}}),e._v(" "),n("ol",{directives:[{name:"show",rawName:"v-show",value:e.menuVisible,expression:"menuVisible"}],ref:"menu",staticClass:"orgBox",attrs:{id:"menu"}},[n("li",[n("nuxt-link",{attrs:{to:{name:"authManagement-organization-orgAdd",params:{orgObj:e.orgObj}}}},[e._v("添加")])],1),e._v(" "),n("li",{directives:[{name:"show",rawName:"v-show",value:e.firstLevel,expression:"firstLevel"}]},[n("nuxt-link",{attrs:{to:{name:"authManagement-organization-orgEdit",params:{orgObj:e.orgObj}}}},[e._v("修改")])],1),e._v(" "),n("li",{directives:[{name:"show",rawName:"v-show",value:e.firstLevel,expression:"firstLevel"}],on:{click:function(t){return e.orgDel(e.node,e.orgObj)}}},[e._v("删除")])])])]),e._v(" "),n("el-main",[n("div",{staticClass:"tit r"},[n("span",[e._v("用户管理")]),e._v(" "),n("el-button",{staticClass:"addBtn",attrs:{size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.addUpdate("authManagement-organization-add",e.orgObj)}}},[e._v("新增用户")]),e._v(" "),n("el-radio-group",{attrs:{size:"mini"},on:{change:e.changeUser},model:{value:e.userStatus,callback:function(t){e.userStatus="string"==typeof t?t.trim():t},expression:"userStatus"}},[n("el-radio-button",{attrs:{label:"0"}},[e._v("活动用户")]),e._v(" "),n("el-radio-button",{attrs:{label:"1"}},[e._v("注销用户")])],1)],1),e._v(" "),n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoad,expression:"isLoad"}]},[n("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.tableData}},[n("el-table-column",{attrs:{label:"序号",type:"index"}}),e._v(" "),n("el-table-column",{attrs:{label:"姓名",prop:"userName"}}),e._v(" "),n("el-table-column",{attrs:{label:"用户名","show-overflow-tooltip":"",prop:"loginName"}}),e._v(" "),e.cloShow?n("el-table-column",{attrs:{label:"角色",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-popover",{attrs:{trigger:"hover",placement:"top"}},[n("p",[e._v("姓名: "+e._s(t.row.name))]),e._v(" "),n("p",[e._v("住址: "+e._s(t.row.address))]),e._v(" "),n("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[n("a",{attrs:{size:"medium"}},[e._v(e._s(t.row.name))])])])]}}],null,!1,3645692099)}):e._e(),e._v(" "),n("el-table-column",{attrs:{label:"状态",formatter:e.statusEve,prop:"status"}}),e._v(" "),n("el-table-column",{attrs:{"min-width":"100",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tooltip",{attrs:{content:"编辑",placement:"bottom"}},[n("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-edit"},on:{click:function(n){return e.addUpdate("authManagement-organization-edit",e.orgObj,t.row)}}})],1),e._v(" "),n("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:e.setFlag,expression:"setFlag"}],attrs:{content:"注销",placement:"bottom"}},[n("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete"},on:{click:function(n){return n.stopPropagation(),e.handleDelete(t.$index,t.row)}}})],1),e._v(" "),n("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:e.setFlag,expression:"setFlag"}],attrs:{content:e.iconCont,placement:"bottom"}},[n("el-button",{attrs:{size:"mini",type:"info",icon:0==t.row.status?"el-icon-unlock":"el-icon-lock"},on:{click:function(n){return n.stopPropagation(),e.changeIcon(t.$index,t.row)}}})],1),e._v(" "),n("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:e.setFlag,expression:"setFlag"}],attrs:{content:"重置",placement:"bottom"}},[n("el-button",{attrs:{size:"mini",type:"warning",icon:"el-icon-minus-circle"}})],1),e._v(" "),n("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:e.setFlag,expression:"setFlag"}],attrs:{content:"角色配置",placement:"bottom"}},[n("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-setting"}})],1),e._v(" "),n("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:!e.setFlag,expression:"!setFlag"}],attrs:{content:"还原",placement:"bottom"}},[n("el-button",{attrs:{size:"mini",type:"warning",icon:"el-icon-delete"}})],1)]}}])})],1),e._v(" "),n("el-pagination",{attrs:{small:"",layout:"total, prev, pager, next, jumper","current-page":e.pageNo,"page-size":e.pageSize,total:e.total},on:{"current-change":e.changePage}})],1)])],1)],1)},[],!1,null,"03213967",null);t.default=component.exports}}]);